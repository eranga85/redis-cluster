version: "3.8"

services:
  redis-node-0:
    image: redis:latest
    container_name: node0
    volumes:
      - ./redis/cluster-0/redis.conf:/etc/usr/local/redis.conf
      - ./redis/cluster-0/data:/data
    network_mode: host
    command: redis-server /etc/usr/local/redis.conf

  redis-node-1:
    image: redis:latest
    container_name: node1
    volumes:
      - ./redis/cluster-1/redis.conf:/etc/usr/local/redis.conf
      - ./redis/cluster-1/data:/data
    network_mode: host
    command: redis-server /etc/usr/local/redis.conf

  redis-node-2:
    image: redis:latest
    container_name: node2
    volumes:
      - ./redis/cluster-2/redis.conf:/etc/usr/local/redis.conf
      - ./redis/cluster-2/data:/data
    network_mode: host
    command: redis-server /etc/usr/local/redis.conf

  redis-node-3:
    image: redis:latest
    container_name: node3
    volumes:
      - ./redis/cluster-3/redis.conf:/etc/usr/local/redis.conf
      - ./redis/cluster-3/data:/data
    network_mode: host
    command: redis-server /etc/usr/local/redis.conf

  redis-node-4:
    image: redis:latest
    container_name: node4
    volumes:
      - ./redis/cluster-4/redis.conf:/etc/usr/local/redis.conf
      - ./redis/cluster-4/data:/data
    network_mode: host
    command: redis-server /etc/usr/local/redis.conf

  redis-node-5:
    image: redis:latest
    container_name: node5
    volumes:
      - ./redis/cluster-5/redis.conf:/etc/usr/local/redis.conf
      - ./redis/cluster-5/data:/data
    network_mode: host
    command: redis-server /etc/usr/local/redis.conf

  redis-cluster-init:
    image: redis:latest
    container_name: node_init
    command: redis-server --port 6379
    network_mode: host
    depends_on:
      - redis-node-0
      - redis-node-1
      - redis-node-2
      - redis-node-3
      - redis-node-4
      - redis-node-5
    volumes:
      - ./init-cluster.sh:/init-cluster.sh
    entrypoint: /bin/sh /init-cluster.sh
    environment:
      - "IP_HOST=127.0.0.1"
      - "NODE_0_PORT=6380"
      - "NODE_1_PORT=6381"
      - "NODE_2_PORT=6382"
      - "NODE_3_PORT=6383"
      - "NODE_4_PORT=6384"
      - "NODE_5_PORT=6385"
